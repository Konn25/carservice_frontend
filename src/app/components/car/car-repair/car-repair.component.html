
<div class="container text-center my-3">
    <h1 class="my-3">Repairs </h1>
    <button type="button" (click)="goBack()" class="btn btn-primary me-2">Back</button>
    <button type="button" (click)="openModal(newRepair)" class="btn btn-primary me-2">Add new repair</button>

    <!-- The new repair modal -->
    <ng-template #newRepair let-modal>
        <div class="modal-header">
            <h4 class="modal-title" id="modal-basic-title">Add new repair</h4>
            <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
        </div>
        <div class="modal-body">
            <table class="mx-auto w-auto table-sm">
                <tbody>
                  <tr>
                    <td>Repair name: </td>
                    <td>
                        <select id="selectRepair" #repairNamesSelect (change)="selectRepairName(repairNamesSelect.value)"  >
                            <option value="null">----</option> 
                            <option *ngFor="let y of repairName" value="{{y.id}}" >{{y.repairName}}</option>
                        </select>
                    </td>
                  </tr>
                  <tr>
                    <td>Price: </td>
                    <td> <input id="repairPrice" type="number" min="0" #price></td>
                  </tr>
                  <tr>
                    <td>Date: </td>
                    <td><input id="selectDate" type="date" #date></td>
                  </tr>
                </tbody>
                </table>


        </div>
        <div class="modal-footer">
            <button id="saveRepair" type="button" class="btn btn-outline-dark" (click)="addNewRepair(price.value, date.value)">Save</button>
        </div>
    </ng-template>

</div>

<div>


<table class="table">
    <thead>
        <tr>
          <th scope="col">Name</th>
          <th scope="col">Date</th>
          <th scope="col">Price</th>
          <th scope="col">Update</th>
          <th scope="col">Delete</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let x of repairs">
            <th scope="row" >{{  this.checkRepairName(x.repair_id) }}</th>
            <td>{{x.date}}</td>
            <td>{{x.price}}</td>
            <td><button type="button" (click)="openModal(content)"  class="btn btn-success me-1" data-bs-toggle="modal" data-bs-target="#updateModal">
                <i class="bi bi-pencil-square"></i></button></td>
            <td><button type="button" (click)="deleteRepair(x.id)" class="btn btn-danger me-1"><i class="bi bi-trash3-fill"></i></button></td>
            
            <!-- The update modal -->
           <ng-template #content let-modal>
                <div class="modal-header">
                    <h4 class="modal-title" id="modal-basic-title">Update Repair</h4>
                    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
                </div>
                <div class="modal-body">
                    <table class="mx-auto w-auto table-sm">
                        <tbody>
                          <tr>
                            <td>Repair name: </td>
                            <td>
                                <select #repairNamesSelect (change)="selectRepairName(repairNamesSelect.value)"  >
                                    <option value="null">----</option> 
                                    <option *ngFor="let y of repairName" value="{{y.id}}" >{{y.repairName}}</option>
                                </select>
                            </td>
                          </tr>
                          <tr>
                            <td>Price: </td>
                            <td>  <input type="number" min="0" value={{x.price}} #price></td>
                          </tr>
                          <tr>
                            <td>Date: </td>
                            <td><input type="date" value={{x.date}} #date></td>
                          </tr>
                        </tbody>
                        </table>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-dark" (click)="updateRepair(x.id, price.value, date.value)">Save</button>
                </div>
            </ng-template>

        </tr>
      </tbody>
</table>

</div>
